<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="BurningBright">
<meta property="og:url" content="http://linchenguang.com/page/2/index.html">
<meta property="og:site_name" content="BurningBright">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BurningBright">





  
  
  <link rel="canonical" href="http://linchenguang.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>BurningBright</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BurningBright</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/11/07/Introducing-Serverless/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/11/07/Introducing-Serverless/" class="post-title-link" itemprop="url">Introducing Serverless</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-11-07 17:19:46" itemprop="dateCreated datePublished" datetime="2019-11-07T17:19:46+08:00">2019-11-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-11-30 10:58:27" itemprop="dateModified" datetime="2019-11-30T10:58:27+08:00">2019-11-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="第1章无服务器简介"><a href="#第1章无服务器简介" class="headerlink" title="第1章无服务器简介"></a>第1章无服务器简介</h1><p>在本章中，我们首先要上一堂历史课，以了解导致我们走向无服务器的原因。在这种情况下，我们将描述什么是无服务器。最后，我们将通过总结为什么无服务器既是云自然增长的一部分，又是我们如何处理应用交付方式的障碍而总结一下。</p>
<h1 id="搭建舞台"><a href="#搭建舞台" class="headerlink" title="搭建舞台"></a>搭建舞台</h1><p>为了将像Serverless这样的技术置于适当的环境中，我们必须首先概述其演进路径中的步骤。</p>
<h2 id="云的诞生"><a href="#云的诞生" class="headerlink" title="云的诞生"></a>云的诞生</h2><p>让我们回到2006年。目前还没有人拥有iPhone，Ruby on Rails是一个炙手可热的新编程环境，并且Twitter也在启动。但是，与该报告更紧密的关系是，许多人将其服务器端应用程序托管在自己拥有的机架式数据中心中。</p>
<p>2006年8月，发生了一些事情，从根本上改变了这种模式。亚马逊的新IT部门亚马逊网络服务（AWS）宣布推出<code>弹性计算云（EC2）</code>。</p>
<p>EC2是众多基础架构即服务（IaaS）产品的首批产品之一。IaaS允许公司租用计算能力（即托管运行面向Internet的服务器应用程序的主机），而不用购买自己的计算机。它还允许他们及时配置主机，从请求计算机到可用性的延迟大约为几分钟。</p>
<p>EC2的五个主要优势是：</p>
<ul>
<li><p>降低人工成本<br>在使用基础架构即服务之前，公司需要雇用特定的技术运营人员，他们将在数据中心工作并管理其物理服务器。这意味着一切，从电源和网络到机架和安装，再到修复机器的物理问题（如内存不足）到设置操作系统（OS）。有了IaaS，所有这些都消失了，而是由IaaS服务提供商（在EC2中为AWS）负责。</p>
</li>
<li><p>在管理自己的物理服务器时，公司会遇到由于意外事件（如硬件故障）而导致的问题。由于硬件问题通常很少发生，并且可能需要很长时间才能解决，因此这会导致长度波动很大的停机时间。使用IaaS，客户在发生硬件故障时仍然有一些工作要做，而不再需要知道如何修复硬件。取而代之的是，客户只需在几分钟之内请求一个可用的新机器实例，然后重新安装该应用程序，就可以避免此类问题的发生。</p>
</li>
<li><p>降低基础设施成本<br>在许多情况下，考虑到电源，网络等因素，连接的EC2实例的成本要比运行自己的硬件便宜。当您只想运行几天或几周而不是几个月的主机时，这尤其有效或数年的时间。同样，按小时租用主机而不是直接购买主机会导致不同的会计处理：EC2机器是运营费用（Opex），而不是物理机器的资本费用（Capex），通常允许更有利的会计灵活性。</p>
</li>
<li><p>缩放比例<br>考虑到IaaS带来的扩展优势，基础架构成本将大幅下降。借助IaaS，公司在扩展其运行的服务器的数量和类型方面具有更大的灵活性。您不再需要预先购买10台高端服务器，因为您认为几个月后可能会需要它们。相反，您可以从一个或两个低功耗，便宜的实例开始，然后随时间上下扩展实例的数量和类型，而不会产生任何负面成本影响。</p>
</li>
<li><p>交货时间<br>在自托管服务器的糟糕年代，要为新应用程序购买和配置服务器可能要花费数月的时间。如果您想在几周内尝试一下，那太糟糕了。使用IaaS，交货时间从数月缩短至数分钟。在精益创业的思想鼓舞下，这已经进入了快速产品试验的时代。</p>
</li>
</ul>
<h2 id="基础设施外包"><a href="#基础设施外包" class="headerlink" title="基础设施外包"></a>基础设施外包</h2><p>使用IaaS是一种我们可以定义为基础设施外包的技术。当我们开发和操作软件时，我们可以通过两种方式分解工作的需求：针对我们需求的需求，以及与其他以类似方式工作的团队和组织相同的需求。我们可以将第二组需求定义为基础设施，范围从实物商品（例如运行机器的电力）一直到常见的应用程序功能（如用户身份验证）。</p>
<p>基础设施外包通常可以由服务提供商或供应商提供。例如，电力由电力供应商提供，并且网络由互联网服务提供商（ISP）提供。卖方能够通过两种策略来获利地提供这种服务：我们现在描述的经济和技术策略。</p>
<h3 id="规模经济"><a href="#规模经济" class="headerlink" title="规模经济"></a>规模经济</h3><p>规模经济的思想至少几乎部分支持了基础设施外包的每种形式-由于可以利用效率，总体上多次做同一件事比独立进行这些事情总和要便宜。</p>
<p>例如，AWS可以以比小型公司更低的价格购买相同规格的服务器，因为AWS所购买的服务器是数千台而不是单独购买。同样，与拥有少数机器的公司相比，AWS的每台服务器硬件支持成本要低得多。</p>
<h3 id="技术改进"><a href="#技术改进" class="headerlink" title="技术改进"></a>技术改进</h3><p>基础设施外包通常也部分归因于技术创新。就EC2而言，变化是<code>硬件虚拟化</code>。</p>
<p>在IaaS出现之前，一些IT供应商已经开始允许公司将物理服务器作为主机租用，通常在一个月之内。尽管有些公司使用了这项服务，但按小时租用主机的替代方案更具吸引力。但是，只有将物理服务器细分为许多小型的，快速启动和关闭的虚拟机（VM）后，这才真正可行。一旦有可能，IaaS就诞生了。</p>
<h3 id="共同利益"><a href="#共同利益" class="headerlink" title="共同利益"></a>共同利益</h3><p>基础设施外包通常会呼应IaaS的五个好处：</p>
<ul>
<li><p>降低了劳动力成本-减少了人员，减少了执行基础设施工作所需的时间</p>
</li>
<li><p>降低风险-更少的专业知识专家和更实时的运营支持能力</p>
</li>
<li><p>降低资源成本-相同功能的成本更低</p>
</li>
<li><p>扩展的灵活性更高-可以访问更多资源和不同类型的相似资源，然后进行处理，而不会造成重大损失或浪费</p>
</li>
<li><p>交货时间更短-从概念到生产可用性的上市时间缩短</p>
</li>
</ul>
<p>当然，基础设施外包也有其弊端和局限性，我们将在本报告的后面部分进行介绍。</p>
<h2 id="云长大"><a href="#云长大" class="headerlink" title="云长大"></a>云长大</h2><p>IaaS与存储（例如AWS <code>Simple Storage Service（S3）</code>）一起是云的第一个关键要素之一。AWS是一个先行者，现在仍然是领先的云提供商，但是还有许多其他供应商，从大型厂商（如Microsoft和Google）到尚未大型的厂商（如DigitalOcean）。</p>
<p>当我们谈论“云”时，我们通常指的是公共云，即由供应商提供的，与您自己的公司分离并托管在供应商自己的数据中心中的基础结构服务的集合。但是，我们还看到了云产品的相关增长，公司可以使用诸如<code>Open Stack</code>之类的工具在自己的数据中心中使用云产品。这样的自托管系统通常被称为私有云，并利用自己的硬件和物理空间的行为称为内部部署（或只是的预置型。）</p>
<p>公共云的下一个发展是平台即服务（PaaS）。Heroku是最受欢迎的PaaS提供商之一。PaaS在IaaS之上分层，将操作系统（OS）添加到要外包的基础架构中。使用PaaS，您仅部署应用程序，该平台负责操作系统安装，补丁程序升级，系统级监视，服务发现等。</p>
<p>PaaS在<code>Cloud Foundry</code>中还具有流行的自托管开源变体。由于PaaS位于现有虚拟化解决方案之上，因此您可以在本地或较低级别的IaaS公共云服务上托管“私有PaaS”。同时使用公共和私有云系统通常被称为混合云 ; 能够在两种环境中实施一个PaaS可能是一项有用的技术。</p>
<p>在虚拟机之上使用PaaS的另一种方法是使用容器。在过去的几年中，<code>Docker</code>变得越来越受欢迎，因为它可以从操作系统本身的本质上更加清晰地描述应用程序的系统要求。有基于云的服务代表团队托管和管理/协调容器，通常称为容器即服务（CaaS）。一个公共云示例是Google的<code>Container Engine</code>。一些自托管的CaaS是<code>Kubernetes</code>和<code>Mesos</code>，您可以将其私有运行，也可以像PaaS一样在公共IaaS服务之上运行。</p>
<p>与IaaS一样，由供应商提供的PaaS和CaaS都是基础设施外包的进一步形式。它们与IaaS的主要不同之处在于，它们进一步提高了抽象级别，使我们可以将更多技术转让给他人。因此，PaaS和CaaS的优势与我们前面列出的五种优势相同。</p>
<p>更具体地说，我们可以将所有这三种（IaaS，PaaS，CaaS）归为“ 计算即服务”；换句话说，可以在其中运行我们自己的专用软件的不同类型的通用环境。我们将很快再次使用此术语。</p>
<h2 id="进入无服务器阶段右移"><a href="#进入无服务器阶段右移" class="headerlink" title="进入无服务器阶段右移"></a>进入无服务器阶段右移</h2><p>因此，距云诞生已有十多年了。进行此阐述的主要原因是，本报告的主题“无服务器”被最简单地描述为云计算的下一个发展，以及另一种形式的基础设施外包。它具有我们已经看到的相同的五个总体好处，并且能够通过规模经济和技术进步提供这些好处。但是除此之外，无服务器是什么？</p>
<h1 id="定义无服务器"><a href="#定义无服务器" class="headerlink" title="定义无服务器"></a>定义无服务器</h1><p>一旦我们对Serverless有了任何详细的了解，就会遇到第一个令人困惑的点：Serverless实际上涵盖了一系列技术。我们将这些想法分为两个领域：后端即服务（BaaS）和功能即服务（FaaS）。</p>
<h2 id="后端即服务"><a href="#后端即服务" class="headerlink" title="后端即服务"></a>后端即服务</h2><p>BaaS就是要用现成的服务替换我们编写和/或管理的服务器端组件。它在概念上更接近软件即服务（SaaS），而不是虚拟实例和容器之类的东西。SaaS通常是将业务流程外包（例如人力资源或销售工具，或者在技术方面，是Github之类的产品），而BaaS则将我们的应用程序分解为较小的部分，并完全通过外部产品来实现其中的一些部分。</p>
<p>BaaS服务是领域通用的远程组件（即不是进程内库），我们可以将其集成到我们的产品中，其中API是典型的集成范例。</p>
<p>BaaS在开发移动应用程序或单页Web应用程序的团队中特别受欢迎。许多这样的团队能够极大地依赖第三方服务来执行原本需要自己完成的任务。让我们看几个例子。</p>
<p>首先，我们拥有Google <code>Firebase</code>之类的服务（在关闭之前，解析是）。Firebase是由供应商（在本例中为Google）完全管理的数据库产品，可以直接从移动或Web应用程序使用，而无需我们自己的中间应用程序服务器。这代表了BaaS的一个方面：代表我们管理数据组件的服务。</p>
<p>BaaS服务还使我们能够依赖其他人已经实现的应用程序逻辑。一个很好的例子是身份验证-许多应用程序实现自己的代码以执行注册，登录，密码管理等，但是在许多应用程序中，此代码通常非常相似。团队和企业之间的这种重复已经成熟，可以提取到外部服务中了，而这正是<code>Auth0</code>和Amazon的<code>Cognito</code>之类的产品的目标。这两个产品都允许移动应用程序和Web应用程序具有完整的身份验证和用户管理功能，而无需开发团队编写或管理任何代码来实现这些功能。</p>
<p>随着移动应用程序开发的兴起，后端即服务这一术语变得特别流行。实际上，该术语有时称为移动后端即服务（MBaaS）。但是，在我们的应用程序开发中使用完全外部管理的产品的关键思想并不是移动开发乃至整个前端开发所独有的。例如，我们可能会停止在EC2机器上管理自己的MySQL数据库服务器，而改用Amazon的<code>RDS</code>服务，或者可能会用<code>Kinesis</code>替换我们的自管式Kafka消息总线安装。其他数据基础结构服务包括<code>文件系统</code>/<code>对象存储</code>和<code>数据仓库</code>，而更多面向逻辑的示例包括<code>语音分析</code>以及我们前面提到的身份验证产品，也可以在服务器端组件中使用它们。这些服务中的许多服务都可以被认为是无服务器服务，但并不是全部—我们将在第5章中定义我们认为有区别的无服务器服务。</p>
<h2 id="充当服务-无服务器计算"><a href="#充当服务-无服务器计算" class="headerlink" title="充当服务/无服务器计算"></a>充当服务/无服务器计算</h2><p>无服务器的另一半是功能即服务（FaaS）。FaaS是“计算即服务”的另一种形式，这是一种通用环境，我们可以在其中运行软件，如前所述。实际上，有些人（尤其是AWS）将FaaS称为无服务器计算。来自AWS的<code>Lambda</code>是当前使用最广泛的FaaS实施。</p>
<p>FaaS是一种构建和部署服务器端软件的新方法，其重点是部署单个功能或操作。FaaS是有关Serverless的众多话题的来源。实际上，许多人认为Serverless 是 FaaS，但他们并未完全了解。</p>
<p>在传统上部署服务器端软件时，我们从主机实例开始，通常是虚拟机（VM）实例或容器（请参见图1-1）。然后，我们在主机中部署我们的应用程序。如果我们的主机是VM或容器，则我们的应用程序是操作系统进程。通常，我们的应用程序包含用于几种不同但相关的操作的代码。例如，Web服务可以允许资源的检索和更新。</p>
<p><img src="/2019/11/07/Introducing-Serverless/wisl_0101.png" alt="图1-1。传统服务器端软件部署"></p>
<p>FaaS更改了这种部署模型（请参见图1-2）。我们从模型中剥离了主机实例和应用程序过程。相反，我们只专注于表达应用程序逻辑的单个操作或函数。我们将这些功能分别上传到供应商提供的FaaS平台。</p>
<p><img src="/2019/11/07/Introducing-Serverless/wisl_0102.png" alt="图1-2。FaaS软件部署"></p>
<p>但是，这些功能在服务器进程中并不是一直处于活动状态，而是闲置直到需要像在传统系统中一样运行之前（图1-3）。而是将FaaS平台配置为侦听每个操作的特定事件。发生该事件时，供应商平台会实例化Lambda函数，然后使用触发事件对其进行调用。</p>
<p><img src="/2019/11/07/Introducing-Serverless/wisl_0103.png" alt="图1-3。FaaS功能生命周期"></p>
<p>一旦函数执行完毕，FaaS平台就可以随意拆除它。另外，作为一种优化，它可以将功能保留一小段时间，直到有另一个事件要处理为止。</p>
<p>FaaS本质上是一种事件驱动的方法。FaaS供应商除了提供托管和执行代码的平台外，还集成了各种同步和异步事件源。同步源的一个示例是HTTP API网关。异步源的一个示例是托管消息总线，对象存储或类似于（cron）的计划事件。</p>
<p>AWS Lambda于2014年秋季推出，从那时起，它的成熟度和使用率都在增长。虽然Lambda的某些用法很少使用，每天仅执行几次，但有些公司每天使用Lambda处理数十亿个事件。在撰写本文时，Lambda已与15种以上不同类型的<code>事件源</code>集成在一起，使其可用于多种不同的应用程序。</p>
<p>除AWS Lambda之外，还有Microsoft，IBM，Google和Auth0等较小的提供商提供的其他几种商业FaaS产品。就像我们之前讨论的其他各种“计算即服务”平台（IaaS，PaaS，CaaS）一样，也有一些开源项目，您可以在自己的硬件或公共云上运行。这个私有的FaaS空间目前很忙，没有明确的负责人，并且在撰写本文时，许多选项还处于开发初期。示例包括<code>Galactic Fog</code>，<code>IronFunctions</code>，<code>Fission（使用Kubernetes）</code>以及IBM自己的<code>OpenWhisk</code>。</p>
<h2 id="无服务器的共同主题"><a href="#无服务器的共同主题" class="headerlink" title="无服务器的共同主题"></a>无服务器的共同主题</h2><p>从表面上看，BaaS和FaaS完全不同：第一个是完全外包应用程序的各个元素，第二个是用于运行自己的代码的新托管环境。那么，为什么我们将它们归为Serverless的一部分呢？</p>
<p>关键是既不需要您管理自己的服务器主机或服务器进程。使用完全无服务器的应用程序，您不再需要将架构的任何部分视为在主机上运行的资源。您所有的逻辑（无论您是自己编写代码还是与第三方服务集成）都在完全弹性的操作环境中运行。您的状态也以类似的弹性形式存储。无服务器并不意味着服务器已经消失，这意味着您不再需要担心它们。</p>
<p>因为这个关键主题，巴斯和FAAS有着一些共同的优点和局限性，我们在章节看3和4。无服务器方法还有其他一些区别，这也是FaaS和BaaS的共同点，我们将在第5章中介绍。</p>
<h1 id="颠簸的进化"><a href="#颠簸的进化" class="headerlink" title="颠簸的进化"></a>颠簸的进化</h1><p>我们在序言中提到Serverless是一种演进。其原因是，在过去的十年中，我们将更多关于应用程序和环境的共同点转移到了外包的商品服务上。我们看到了无服务器的趋势，即将主机管理，操作系统管理，资源分配，扩展甚至应用逻辑的整个组件外包，并考虑这些因素。经济上和运营上都有自然的进步。</p>
<p>但是，在应用程序体系结构方面，Serverless发生了很大的变化。到目前为止，大多数云服务都没有从根本上改变我们设计应用程序的方式。例如，当使用诸如Docker之类的工具时，我们在应用程序周围放置了一个更薄的“盒子”，但它仍然是盒子，并且我们的逻辑体系结构没有明显改变。在云中托管我们自己的MySQL实例时，我们仍然需要考虑处理负载的虚拟机的功能，并且我们还需要考虑故障转移。</p>
<p>这种情况随着Serverless的改变而改变，并且不是逐渐的，而是震动。无服务器FaaS通过基本的事件驱动模型，更细化的部署形式以及需要在FaaS组件之外保持状态的方式来驱动非常不同类型的应用程序体系结构（我们将在后面详细介绍）。无服务器BaaS使我们无需编写整个逻辑组件，但需要我们将应用程序与供应商提供的特定接口和模型集成在一起。</p>
<p>那么，如果无服务器应用程序如此不同，它会是什么样呢？这就是我们接下来将在第2章中探讨的内容。</p>
<p><a href="https://www.oreilly.com/library/view/what-is-serverless/9781491984178/ch01.html" target="_blank" rel="noopener">https://www.oreilly.com/library/view/what-is-serverless/9781491984178/ch01.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/10/19/cmake-tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/19/cmake-tutorial/" class="post-title-link" itemprop="url">cmake tutorial</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-19 09:17:31" itemprop="dateCreated datePublished" datetime="2019-10-19T09:17:31+08:00">2019-10-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-02-27 15:23:52" itemprop="dateModified" datetime="2020-02-27T15:23:52+08:00">2020-02-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">`-- main.c</span><br></pre></td></tr></table></figure>
<p>main.c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;testFunc.h&quot;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;Hello World\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CMakeLists.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">add_executable(main main.c)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@8bdf5f3b23af demo]# cmake .</span><br><span class="line">-- The C compiler identification is GNU 8.2.1</span><br><span class="line">-- The CXX compiler identification is GNU 8.2.1</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /root/labc/demo</span><br></pre></td></tr></table></figure>
<p>command generated <code>MakeFile</code>, and some auto generate file.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeCache.txt</span><br><span class="line">|-- CMakeFiles</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- Makefile</span><br><span class="line">|-- cmake_install.cmake</span><br><span class="line">`-- main.c</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@8bdf5f3b23af demo]# make</span><br><span class="line">Scanning dependencies of target main</span><br><span class="line">[ 50%] Building C object CMakeFiles/main.dir/main.c.o</span><br><span class="line">[100%] Linking C executable main</span><br><span class="line">[100%] Built target main</span><br></pre></td></tr></table></figure>
<p>make and execute</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@8bdf5f3b23af demo]# ./main</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>
<h2 id="Multi-source-filie-under-one-directory"><a href="#Multi-source-filie-under-one-directory" class="headerlink" title="Multi-source filie under one directory"></a>Multi-source filie under one directory</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- main.c</span><br><span class="line">|-- testFunc.c</span><br><span class="line">`-- testFunc.h</span><br></pre></td></tr></table></figure>
<p>testFunc.c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * testFunc.c</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;testFunc.h&quot;</span><br><span class="line"></span><br><span class="line">void func(int data)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;data is %d\n&quot;, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>testFunc.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * testFunc.h</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#ifndef _TEST_FUNC_H_</span><br><span class="line">#define _TEST_FUNC_H_</span><br><span class="line"></span><br><span class="line">void func(int data);</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></p>
<p>main.c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;testFunc.h&quot;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    func(100);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CMakeLists.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">add_executable(main main.c testFunc.c)</span><br></pre></td></tr></table></figure></p>
<p>add <code>testFunc.c</code> to executable param</p>
<p>make and execute</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@8bdf5f3b23af multsource]# ./main</span><br><span class="line">data is 100</span><br></pre></td></tr></table></figure>
<p>if we have a lot of source file, <code>add_executable</code> is troublesome.<br><code>aux_source_directory</code> can take files under directory as a source.</p>
<p>add another function<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- main</span><br><span class="line">|-- main.c</span><br><span class="line">|-- testFunc.c</span><br><span class="line">|-- testFunc.h</span><br><span class="line">|-- testFunc1.c</span><br><span class="line">`-- testFunc1.h</span><br></pre></td></tr></table></figure></p>
<p>modify CMakeLists<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">aux_source_directory(. SRC_LIST)</span><br><span class="line"></span><br><span class="line">add_executable(main $&#123;SRC_LIST&#125;)</span><br></pre></td></tr></table></figure></p>
<p>make and execute<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@8bdf5f3b23af multsource1]# ./main</span><br><span class="line">data is 100</span><br><span class="line">data is 200</span><br></pre></td></tr></table></figure></p>
<h2 id="Multi-source-filie-under-multi-directory"><a href="#Multi-source-filie-under-multi-directory" class="headerlink" title="Multi-source filie under multi-directory"></a>Multi-source filie under multi-directory</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- main</span><br><span class="line">|-- main.c</span><br><span class="line">|-- test_func</span><br><span class="line">|   |-- testFunc.c</span><br><span class="line">|   `-- testFunc.h</span><br><span class="line">`-- test_func1</span><br><span class="line">    |-- testFunc1.c</span><br><span class="line">    `-- testFunc1.h</span><br></pre></td></tr></table></figure>
<p>group function by two directory <code>test_func</code> <code>test_func1</code></p>
<p>modify <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">include_directories (test_func test_func1)</span><br><span class="line"></span><br><span class="line">aux_source_directory (test_func SRC_LIST)</span><br><span class="line">aux_source_directory (test_func1 SRC_LIST1)</span><br><span class="line"></span><br><span class="line">add_executable (main main.c $&#123;SRC_LIST&#125; $&#123;SRC_LIST1&#125;)</span><br></pre></td></tr></table></figure></p>
<p>result is same as above.</p>
<h2 id="Formal-structure"><a href="#Formal-structure" class="headerlink" title="Formal structure"></a>Formal structure</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- bin</span><br><span class="line">|-- build</span><br><span class="line">|-- include</span><br><span class="line">|   |-- testFunc.h</span><br><span class="line">|   `-- testFunc1.h</span><br><span class="line">|-- main</span><br><span class="line">`-- src</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    |-- main.c</span><br><span class="line">    |-- testFunc.c</span><br><span class="line">    `-- testFunc1.c</span><br></pre></td></tr></table></figure>
<ol>
<li>put source file to <code>src</code></li>
<li>put head file to <code>include</code></li>
<li><code>build</code> used to store middle file</li>
<li><code>bin</code> used to store executable file</li>
</ol>
<p>outside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">add_subdirectory (src)</span><br></pre></td></tr></table></figure></p>
<p>inside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory (. SRC_LIST)</span><br><span class="line"></span><br><span class="line">include_directories (../include)</span><br><span class="line"></span><br><span class="line">add_executable (main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line">set (EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>EXECUTABLE_OUTPUT_PATH</code> : executable file path</li>
<li><code>PROJECT_SOURCE_DIR</code> : project root</li>
</ul>
<p>result is same as above.</p>
<h2 id="Dynamic-and-static-libraries"><a href="#Dynamic-and-static-libraries" class="headerlink" title="Dynamic and static libraries"></a>Dynamic and static libraries</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- build</span><br><span class="line">|-- lib</span><br><span class="line">`-- lib_testFunc</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    |-- testFunc.c</span><br><span class="line">    `-- testFunc.h</span><br></pre></td></tr></table></figure>
<p>outside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">add_subdirectory (lib_testFunc)</span><br></pre></td></tr></table></figure></p>
<p>inside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory (. SRC_LIST)</span><br><span class="line"></span><br><span class="line">add_library (testFunc_shared SHARED $&#123;SRC_LIST&#125;)</span><br><span class="line">add_library (testFunc_static STATIC $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line">set_target_properties (testFunc_shared PROPERTIES OUTPUT_NAME &quot;testFunc&quot;)</span><br><span class="line">set_target_properties (testFunc_static PROPERTIES OUTPUT_NAME &quot;testFunc&quot;)</span><br><span class="line"></span><br><span class="line">set (LIBRARY_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/lib)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>add_library</code>: generate dynamic or static libraries, (1. libname; 2. dynamic or static, static in default; 3. source file path)</li>
<li><code>set_target_properties</code>: setting output name, can set other options like lib version</li>
<li><code>LIBRARY_OUTPUT_PATH</code>: default path of library file</li>
</ul>
<p>in <code>build</code> run <code>cmake .</code> and <code>make</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- build</span><br><span class="line">|   |-- CMakeCache.txt</span><br><span class="line">|   |-- CMakeFiles</span><br><span class="line">|   |-- Makefile</span><br><span class="line">|   |-- cmake_install.cmake</span><br><span class="line">|   `-- lib_testFunc</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- libtestFunc.a</span><br><span class="line">|   `-- libtestFunc.so</span><br><span class="line">`-- lib_testFunc</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    |-- testFunc.c</span><br><span class="line">    `-- testFunc.h</span><br></pre></td></tr></table></figure></p>
<h2 id="Link-by-libraries"><a href="#Link-by-libraries" class="headerlink" title="Link by libraries"></a>Link by libraries</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- bin</span><br><span class="line">|-- build</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- libtestFunc.a</span><br><span class="line">|   `-- libtestFunc.so</span><br><span class="line">|-- lib_testFunc</span><br><span class="line">|   |-- CMakeLists.txt</span><br><span class="line">|   |-- testFunc.c</span><br><span class="line">|   `-- testFunc.h</span><br><span class="line">`-- src</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    `-- main.c</span><br></pre></td></tr></table></figure>
<p>outside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">add_subdirectory (lib_testFunc)</span><br><span class="line"></span><br><span class="line">add_subdirectory (src)</span><br></pre></td></tr></table></figure></p>
<p>inside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory (. SRC_LIST)</span><br><span class="line"></span><br><span class="line"># find testFunc.h</span><br><span class="line">include_directories (../lib_testFunc)</span><br><span class="line"></span><br><span class="line">link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib)</span><br><span class="line"></span><br><span class="line">add_executable (main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line">target_link_libraries (main testFunc)</span><br><span class="line"></span><br><span class="line">set (EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>link_directories</code> : Add non-standard shared library search path</li>
<li><code>target_link_libraries</code> : Link the target file with the library file</li>
</ul>
<h2 id="Compile-options"><a href="#Compile-options" class="headerlink" title="Compile options"></a>Compile options</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- bin</span><br><span class="line">|-- build</span><br><span class="line">`-- main.cpp</span><br></pre></td></tr></table></figure>
<p>main.cpp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    auto data = 100;</span><br><span class="line">    std::cout &lt;&lt; &quot;data: &quot; &lt;&lt; data &lt;&lt; &quot;\n&quot;;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CMakeLists.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project (demo)</span><br><span class="line"></span><br><span class="line">set (EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br><span class="line"></span><br><span class="line">add_compile_options(-std=c++11 -Wall)</span><br><span class="line"></span><br><span class="line">add_executable(main main.cpp)</span><br></pre></td></tr></table></figure></p>
<h2 id="Compile-control"><a href="#Compile-control" class="headerlink" title="Compile control"></a>Compile control</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- bin</span><br><span class="line">|-- build</span><br><span class="line">`-- src</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    |-- main1.c</span><br><span class="line">    `-- main2.c</span><br></pre></td></tr></table></figure>
<p>outside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 2.8)</span><br><span class="line"></span><br><span class="line">project(demo)</span><br><span class="line"></span><br><span class="line">option(MYDEBUG &quot;enable debug compilation&quot; OFF)</span><br><span class="line"></span><br><span class="line">set (EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br><span class="line"></span><br><span class="line">add_subdirectory(src)</span><br></pre></td></tr></table></figure></p>
<p>add an option <code>MYDEBUG</code></p>
<p>inside <code>CMakeLists.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"></span><br><span class="line">add_executable(main1 main1.c)</span><br><span class="line"></span><br><span class="line">if (MYDEBUG)</span><br><span class="line">    add_executable(main2 main2.c)</span><br><span class="line">else()</span><br><span class="line">    message(STATUS &quot;Currently is not in debug mode&quot;)    </span><br><span class="line">endif()</span><br></pre></td></tr></table></figure></p>
<p>user <code>MYDEBUG</code> to decide whether or not compile <code>main2</code><br><code>cmake .. -DMYDEBUG=ON &amp;&amp; make</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- bin</span><br><span class="line">|   |-- main1</span><br><span class="line">|   `-- main2</span><br><span class="line">|-- build</span><br><span class="line">|   |-- CMakeCache.txt</span><br><span class="line">|   |-- CMakeFiles</span><br><span class="line">|   |-- Makefile</span><br><span class="line">|   |-- cmake_install.cmake</span><br><span class="line">|   `-- src</span><br><span class="line">`-- src</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    |-- main1.c</span><br><span class="line">    `-- main2.c</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/whahu1989/article/details/82078563" target="_blank" rel="noopener">https://blog.csdn.net/whahu1989/article/details/82078563</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/10/16/delete-docker-image-fail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/16/delete-docker-image-fail/" class="post-title-link" itemprop="url">delete docker image failed</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-16 13:53:37" itemprop="dateCreated datePublished" datetime="2019-10-16T13:53:37+08:00">2019-10-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-11-30 10:58:27" itemprop="dateModified" datetime="2019-11-30T10:58:27+08:00">2019-11-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><p><code>docker images -a</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@CN-BJI-D-de9f66 ~]# docker images -a</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              72dc10d3deba        22 hours ago        230MB</span><br><span class="line">tdtest              latest              e3ad759bb993        22 hours ago        230MB</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              820bc1802af7        22 hours ago        230MB</span><br><span class="line">...</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              ac8cea40eaa0        22 hours ago        223MB</span><br><span class="line">centos              latest              0f3e07c0138f        2 weeks ago         220MB</span><br><span class="line">redis               latest              01a52b3b5cd1        2 weeks ago         98.2MB</span><br><span class="line">ubuntu              latest              2ca708c1c9cc        3 weeks ago         64.2MB</span><br><span class="line">redis               alpine              ed7d2ff5a623        8 weeks ago         29.3MB</span><br></pre></td></tr></table></figure>
<p>when put command <code>docker rmi 820bc1802af7</code>, <code>&lt;none&gt;:&lt;none&gt;</code> image delete fail.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: conflict: unable to delete 820bc1802af7 (cannot be forced) - image has dependent child images</span><br></pre></td></tr></table></figure></p>
<p>this is cause by has other images depend on this image <code>820bc1802af7</code>.<br>use <code>docker image inspect</code>, find current image’s child image, repository tag name.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@CN-BJI-D-de9f66 ~]# docker image inspect --format=&apos;&#123;&#123;.RepoTags&#125;&#125; &#123;&#123;.Id&#125;&#125; &#123;&#123;.Parent&#125;&#125;&apos; $(docker image ls -q --filter since=820bc1802af7)</span><br><span class="line">[tdtest:latest] sha256:e3ad759bb99351a4951df11113e0ad3914a26d55e99e5243e13ebac19373efae sha256:8abd1595d4dfc922b81825940c0f6d73034eeb10b3e2b12a78b3d0e33d78588e</span><br></pre></td></tr></table></figure></p>
<h2 id="mechanism"><a href="#mechanism" class="headerlink" title="mechanism"></a>mechanism</h2><h3 id="kind-one"><a href="#kind-one" class="headerlink" title="kind one"></a>kind one</h3><p><code>&lt;none&gt;:&lt;none&gt;</code> images which be related to the image be deleted will be deleted as will.<br>this kind of <code>&lt;none&gt;:&lt;none&gt;</code> is <code>middle image</code>, it won’t occupy space.</p>
<h3 id="kind-two"><a href="#kind-two" class="headerlink" title="kind two"></a>kind two</h3><p>make a docker image <code>docker build -t hello-world ./</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:latest</span><br><span class="line">RUN echo &apos;hello world&apos;</span><br></pre></td></tr></table></figure></p>
<p>when centos have a new release, build hello-world image again, it will depend on the latest centos.<br>the <code>hello-world</code> depend on older centos, will become <code>&lt;none&gt;:&lt;none&gt;</code> dangling image.<br>this kind of <code>&lt;none&gt;:&lt;none&gt;</code> occupy space, it was originally tag image.</p>
<p>all docker file store at <code>/var/lib/docker/graph</code> in default, docker be called <code>graph layer database</code>.<br>use command <code>docker rmi $(docker images -f &quot;dangling=true&quot; -q)</code> to delete wandering image layer.</p>
<h2 id="other-command"><a href="#other-command" class="headerlink" title="other command"></a>other command</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># stop all container</span><br><span class="line">docker ps -a | grep &quot;Exited&quot; | awk &apos;&#123;print $1 &#125;&apos;|xargs docker stop</span><br><span class="line"></span><br><span class="line"># delete all container</span><br><span class="line">docker ps -a | grep &quot;Exited&quot; | awk &apos;&#123;print $1 &#125;&apos;|xargs docker rm</span><br><span class="line"></span><br><span class="line"># delete all none container</span><br><span class="line">docker images|grep none|awk &apos;&#123;print $3 &#125;&apos;|xargs docker rmi</span><br></pre></td></tr></table></figure>
<p><a href="http://www.ibloger.net/article/3217.html" target="_blank" rel="noopener">http://www.ibloger.net/article/3217.html</a><br><a href="https://segmentfault.com/a/1190000011153919" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011153919</a><br><a href="https://blog.csdn.net/sin_geek/article/details/86736417" target="_blank" rel="noopener">https://blog.csdn.net/sin_geek/article/details/86736417</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/10/16/change-repository-in-centos-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/16/change-repository-in-centos-8/" class="post-title-link" itemprop="url">change repository in centos 8</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-16 09:13:47" itemprop="dateCreated datePublished" datetime="2019-10-16T09:13:47+08:00">2019-10-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-11-30 10:58:27" itemprop="dateModified" datetime="2019-11-30T10:58:27+08:00">2019-11-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="CentOS-Base-repo"><a href="#CentOS-Base-repo" class="headerlink" title="CentOS-Base.repo"></a>CentOS-Base.repo</h2><p>modify /etc/yum.repos.d/CentOS-Base.repo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[BaseOS]</span><br><span class="line">name=CentOS-$releasever - Base</span><br><span class="line">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=BaseOS&amp;infra=$infra</span><br><span class="line">#baseurl=http://mirror.centos.org/$contentdir/$releasever/BaseOS/$basearch/os/</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br></pre></td></tr></table></figure>
<h2 id="CentOS-AppStream-repo"><a href="#CentOS-AppStream-repo" class="headerlink" title="CentOS-AppStream.repo"></a>CentOS-AppStream.repo</h2><p>modify /etc/yum.repos.d/CentOS-AppStream.repo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[AppStream]</span><br><span class="line">name=CentOS-$releasever - AppStream</span><br><span class="line">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=AppStream&amp;infra=$infra</span><br><span class="line">#baseurl=http://mirror.centos.org/$contentdir/$releasever/AppStream/$basearch/os/</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/$releasever/AppStream/$basearch/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br></pre></td></tr></table></figure>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><p>other file not avaliable in default, can change to ali repository as well.<br><a href="https://mirrors.aliyun.com/centos/8/extras/x86_64/os/" target="_blank" rel="noopener">https://mirrors.aliyun.com/centos/8/extras/x86_64/os/</a></p>
<p>reload matadata<br><code>yum makecache</code></p>
<p>when modifying the source on a docker image, use the following description in the <code>Dockerfile</code> to build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RUN mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak</span><br><span class="line">COPY CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line">RUN mv /etc/yum.repos.d/CentOS-AppStream.repo /etc/yum.repos.d/CentOS-AppStream.repo_bak</span><br><span class="line">COPY CentOS-AppStream.repo /etc/yum.repos.d/CentOS-AppStream.repo</span><br><span class="line"></span><br><span class="line">RUN yum makecache</span><br></pre></td></tr></table></figure></p>
<p><a href="http://www.voycn.com/article/centos8-peizhialiyuan-zuixiaohuaanzhuang" target="_blank" rel="noopener">http://www.voycn.com/article/centos8-peizhialiyuan-zuixiaohuaanzhuang</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/10/15/TDengine-in-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/15/TDengine-in-docker/" class="post-title-link" itemprop="url">TDengine in docker</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-15 08:28:18 / Modified: 21:38:58" itemprop="dateCreated datePublished" datetime="2019-10-15T08:28:18+08:00">2019-10-15</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="prepare"><a href="#prepare" class="headerlink" title="prepare"></a>prepare</h2><h3 id="prepare-base-image"><a href="#prepare-base-image" class="headerlink" title="prepare base image"></a>prepare base image</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull centos</span><br></pre></td></tr></table></figure>
<h3 id="prepare-source-code"><a href="#prepare-source-code" class="headerlink" title="prepare source code"></a>prepare source code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:taosdata/TDengine.git</span><br><span class="line">cd TDengine</span><br></pre></td></tr></table></figure>
<p>or download release version package and unpackage</p>
<h3 id="prepare-Dockerfile-file"><a href="#prepare-Dockerfile-file" class="headerlink" title="prepare Dockerfile file"></a>prepare <code>Dockerfile</code> file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># Compile image</span><br><span class="line">FROM centos as compile</span><br><span class="line"></span><br><span class="line">WORKDIR /root</span><br><span class="line"></span><br><span class="line">COPY src/ ./src/</span><br><span class="line">COPY deps/ ./deps/</span><br><span class="line">COPY packaging/ ./packaging/</span><br><span class="line">COPY CMakeLists.txt ./</span><br><span class="line"></span><br><span class="line">RUN yum update -y</span><br><span class="line"></span><br><span class="line">RUN yum group install -y &quot;Development Tools&quot;</span><br><span class="line"></span><br><span class="line">Run yum install -y cmake</span><br><span class="line"></span><br><span class="line">WORKDIR /root/build</span><br><span class="line">RUN cmake .. &amp;&amp; cmake --build .</span><br><span class="line"></span><br><span class="line">CMD [&quot;bash&quot;]</span><br><span class="line"></span><br><span class="line"># Final image</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">WORKDIR /root</span><br><span class="line"></span><br><span class="line">COPY --from=compile /root/build/build/bin /usr/bin/</span><br><span class="line">COPY --from=compile /root/build/build/lib/libtaos.so /usr/lib/</span><br><span class="line">COPY packaging/cfg/taos.cfg /etc/taos/</span><br><span class="line"></span><br><span class="line">RUN echo &quot;charset UTF-8&quot; &gt;&gt; /etc/taos/taos.cfg</span><br><span class="line"></span><br><span class="line">ENV LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/usr/lib&quot;</span><br><span class="line">ENV LC_CTYPE=&quot;en_US.UTF-8&quot;</span><br><span class="line"></span><br><span class="line"># origin blog missing this</span><br><span class="line">ENV LC_ALL=&quot;C&quot;</span><br><span class="line"></span><br><span class="line">CMD [&quot;taosd&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="create-TDengine-image"><a href="#create-TDengine-image" class="headerlink" title="create TDengine image"></a>create TDengine image</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t tdtest .</span><br></pre></td></tr></table></figure>
<h2 id="start-service"><a href="#start-service" class="headerlink" title="start service"></a>start service</h2><h3 id="create-volumn"><a href="#create-volumn" class="headerlink" title="create volumn"></a>create volumn</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume create td_log_vol</span><br><span class="line">docker volume create td_data_vol</span><br></pre></td></tr></table></figure>
<h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name tdtest_run -v td_log_vol:/var/log/taos -v td_data_vol:/var/lib/taos tdtest</span><br></pre></td></tr></table></figure>
<p>if service start fail then check logs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line">docker logs -f -t --tail 50 tdtest_run</span><br></pre></td></tr></table></figure>
<p>Error info like this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2019-10-15T00:51:45.614929519Z TDengine:[1]: Starting TDengine service...</span><br><span class="line">2019-10-15T00:51:45.614966105Z 10/15 00:51:45.614216 7f6a24ce1b80 UTL timezone not configured, set to system default: (UTC, +0000)</span><br><span class="line">2019-10-15T00:51:45.614975483Z 10/15 00:51:45.614410 7f6a24ce1b80 ERROR UTL can&apos;t get locale from system</span><br><span class="line">2019-10-15T00:51:45.614981522Z 10/15 00:51:45.614486 7f6a24ce1b80 UTL Invalid locale:, please set the valid locale in config file</span><br><span class="line">2019-10-15T00:51:45.770437005Z Invalid locale:, please set the valid locale in config file</span><br></pre></td></tr></table></figure>
<p>the 1th process is not <code>/sbin/init</code>, so <code>systemctl</code> command can’t execute.<br>for fix this need option <code>--privileged=true</code> and parameter <code>/sbin/init</code>, it’s not right.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name tdtest_run --privileged=true -v td_log_vol:/var/log/taos -v td_data_vol:/var/lib/taos tdtest /sbin/init</span><br></pre></td></tr></table></figure>
<p>I met a problem here, the docker process started, but <code>taosd</code> server process start failed.<br>At first i thought the <code>datetimectl</code> command can fix this, i try to add<br><code>RUN ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#39;Asia/Shanghai&#39; &gt; /etc/timezone</code><br>in <code>Dockerfile</code> and rebuild image but failed.</p>
<p>Then i try to find the source code where the exception be throw.<br>It’s in <code>TDengine/src/util/src/tglobalcfg.c</code> , the c function <code>setlocale()</code> read location failed.<br>I write a simple c file, to valid this problem, then search in internet.<br>Finally, find a similar problem in other software, the answer is very obviously : caused by environment variable.</p>
<p>When add the variable <code>export LC_ALL=C</code>, the client part <code>taos</code> can start up, the demo c file can printf locale normally.<br>So, add <code>ENV LC_ALL=&quot;C&quot;</code> in <code>Dockerfile</code> and rebuild image, start the container <code>taosd</code> successfully.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name tdtest_run -v td_log_vol:/var/log/taos -v td_data_vol:/var/lib/taos tdtest</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/weixin_34038652/article/details/86236240" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34038652/article/details/86236240</a><br><a href="http://c.biancheng.net/ref/setlocale.html" target="_blank" rel="noopener">http://c.biancheng.net/ref/setlocale.html</a><br><a href="https://www.runoob.com/cprogramming/c-function-setlocale.html" target="_blank" rel="noopener">https://www.runoob.com/cprogramming/c-function-setlocale.html</a></p>
<h3 id="check"><a href="#check" class="headerlink" title="check"></a>check</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># visit container</span><br><span class="line">docker exec -it tdtest_run /bin/bash</span><br><span class="line"># start tdengine client</span><br><span class="line">taos</span><br></pre></td></tr></table></figure>
<h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="code-prepare"><a href="#code-prepare" class="headerlink" title="code prepare"></a>code prepare</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker cp test.tar.gz tdtest_run:/root</span><br><span class="line">docker exec -it tdtest_run bash</span><br><span class="line">cd /root</span><br><span class="line">tar -zxvf test.tar.gz</span><br><span class="line">cd test</span><br></pre></td></tr></table></figure>
<p><a href="/2019/10/15/TDengine-in-docker/test.tar.gz">test.tar.gz</a></p>
<h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><p>modify <code>config/config.sh</code>, modify table num, table record num<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test.sh -F config/config.sh -f config/tdengine.sh</span><br></pre></td></tr></table></figure></p>
<p>result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">You are testing TDengine...</span><br><span class="line">TEST INFORMATION</span><br><span class="line">======================================</span><br><span class="line">Databse              : TDENGINE</span><br><span class="line">Action               : Insert</span><br><span class="line">Schema file          : /root/test/data/schema.txt</span><br><span class="line">Sample file          : /root/test/data/sample.txt</span><br><span class="line">Insert thread        : 10</span><br><span class="line">Detectors            : 10000</span><br><span class="line">Records per detector : 10000</span><br><span class="line">Start time           : 01/01/2015 00:00:00</span><br><span class="line">Time interval        : 900000</span><br><span class="line"></span><br><span class="line">Config dir           : /etc/taos/</span><br><span class="line">Host                 :</span><br><span class="line">User name            : root</span><br><span class="line">Password             : taosdata</span><br><span class="line">DB name              : meterInfo</span><br><span class="line">Table prefix         : meter</span><br><span class="line">STable               : meters</span><br><span class="line">DB property          : days 30 tblocks 500 tables 5000</span><br><span class="line">Records per request  : 200</span><br><span class="line">Insert mode          : 0</span><br><span class="line">Real situation       : 0</span><br><span class="line">======================================</span><br><span class="line">Starting to test...</span><br><span class="line">days 30 tblocks 500 tables 5000</span><br><span class="line">Creating 10000 tables......</span><br><span class="line">TDengine tables are created. Sleep 2 seconds and starting to insert data...</span><br><span class="line"></span><br><span class="line">Inserting data......</span><br><span class="line">ThreadID: 0 start table ID: 0 end table ID: 999</span><br><span class="line">ThreadID: 1 start table ID: 1000 end table ID: 1999</span><br><span class="line">ThreadID: 2 start table ID: 2000 end table ID: 2999</span><br><span class="line">ThreadID: 3 start table ID: 3000 end table ID: 3999</span><br><span class="line">ThreadID: 4 start table ID: 4000 end table ID: 4999</span><br><span class="line">ThreadID: 5 start table ID: 5000 end table ID: 5999</span><br><span class="line">ThreadID: 6 start table ID: 6000 end table ID: 6999</span><br><span class="line">ThreadID: 7 start table ID: 7000 end table ID: 7999</span><br><span class="line">ThreadID: 8 start table ID: 8000 end table ID: 8999</span><br><span class="line">ThreadID: 9 start table ID: 9000 end table ID: 9999</span><br><span class="line">Done! Spent    70.6098 seconds to insert 100000000 records, speed:   1416233.89 R/s</span><br><span class="line">Test done!</span><br></pre></td></tr></table></figure></p>
<h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tdtest_run bash</span><br><span class="line">taos</span><br></pre></td></tr></table></figure>
<p>result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the TDengine shell from linux, client version:1.6.2.2, server version:1.6.2.2</span><br><span class="line">Copyright (c) 2017 by TAOS Data, Inc. All rights reserved.</span><br><span class="line"></span><br><span class="line">taos&gt; select count(*) from meterinfo.meters;</span><br><span class="line">      count(*)       |</span><br><span class="line">======================</span><br><span class="line">            100000000|</span><br><span class="line">Query OK, 1 row(s) in set (0.135594s)</span><br><span class="line"></span><br><span class="line">taos&gt; select count(*) from meterinfo.meters group by loc;</span><br><span class="line">      count(*)       |                  loc                   |</span><br><span class="line">===============================================================</span><br><span class="line">             40000000|                                        |</span><br><span class="line">             20000000|                                        |</span><br><span class="line">             10000000|                                        |</span><br><span class="line">             30000000|                                        |</span><br><span class="line">Query OK, 4 row(s) in set (0.163399s)</span><br></pre></td></tr></table></figure></p>
<h3 id="parameter"><a href="#parameter" class="headerlink" title="parameter"></a>parameter</h3><p><code>config/config.sh</code> data config</p>
<ul>
<li>SCHEMA_FILE:          schema config file, test/data/schema.txt。</li>
<li>SAMPLE_FILE:          sample data file, need echo each other with schema.txt, test program will loop write in these data.</li>
<li>NDETECTORS:           table number</li>
<li>INSERT_THREAD:        thread number</li>
<li>RECORDS_PER_DETECTOR: records number in one table</li>
<li>START_TIME:           start time</li>
<li>TIME_INTERVAL:        data collect interval, unit in millisecond.</li>
</ul>
<p><code>config/tdengine.sh</code> engine config</p>
<ul>
<li>INSERT_DB_NAME:       db name</li>
<li>TB_PREFIX:            table name = prefix + num</li>
<li>STABLE:               super table name</li>
<li>DB_PROPERTY:          database option</li>
<li>RECORDS_PER_REQUEST:  recored num in one insert command, insert limit in 64K</li>
</ul>
<p><a href="https://github.com/taosdata/TDengine" target="_blank" rel="noopener">https://github.com/taosdata/TDengine</a><br><a href="https://github.com/taosdata/TDengine/blob/v1.6/src/util/src/tglobalcfg.c" target="_blank" rel="noopener">https://github.com/taosdata/TDengine/blob/v1.6/src/util/src/tglobalcfg.c</a><br><a href="https://blog.csdn.net/qishidiguadan/article/details/96284529" target="_blank" rel="noopener">https://blog.csdn.net/qishidiguadan/article/details/96284529</a><br><a href="https://blog.csdn.net/u013829518/article/details/99681154" target="_blank" rel="noopener">https://blog.csdn.net/u013829518/article/details/99681154</a><br><a href="https://blog.csdn.net/u012954706/article/details/82588687" target="_blank" rel="noopener">https://blog.csdn.net/u012954706/article/details/82588687</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/09/26/proxy-in-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/26/proxy-in-docker/" class="post-title-link" itemprop="url">proxy in docker</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-09-26 19:21:13" itemprop="dateCreated datePublished" datetime="2019-09-26T19:21:13+08:00">2019-09-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-15 21:38:58" itemprop="dateModified" datetime="2019-10-15T21:38:58+08:00">2019-10-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><ol>
<li>Create directory</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/systemd/system/docker.service.d</span><br></pre></td></tr></table></figure>
<ol>
<li>create proxy file</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/docker.service.d/http-proxy.conf</span><br></pre></td></tr></table></figure>
<ol>
<li>modify file</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Environment=&quot;HTTPS_PROXY=http://username:password@192.168.1.1:8080&quot; &quot;NO_PROXY=localhost,127.0.0.1&quot;</span><br></pre></td></tr></table></figure>
<ol>
<li>save &amp; flush</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<ol>
<li>verify</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl show --property=Environment docker</span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/atuotuo/p/7298673.html" target="_blank" rel="noopener">https://www.cnblogs.com/atuotuo/p/7298673.html</a><br><a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy" target="_blank" rel="noopener">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/09/11/Learning-jackson/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/11/Learning-jackson/" class="post-title-link" itemprop="url">Learning jackson</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-09-11 19:41:49" itemprop="dateCreated datePublished" datetime="2019-09-11T19:41:49+08:00">2019-09-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-15 21:38:58" itemprop="dateModified" datetime="2019-10-15T21:38:58+08:00">2019-10-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="JS-number-type-accuracy-problem"><a href="#JS-number-type-accuracy-problem" class="headerlink" title="JS number type accuracy problem"></a>JS number type accuracy problem</h2><p>In js number type is 53 bit, if backgroud response 64 bit long type,<br>js will lose accuracy, number will not be the origin number.</p>
<p>53 bit in decimal system length is about 16(2^52),but in java long type is about 20(2^64).<br>So backgroud return type in string is a better choice to void accuracy problem.</p>
<h2 id="JsonSerializer-JsonDeserializer"><a href="#JsonSerializer-JsonDeserializer" class="headerlink" title="JsonSerializer JsonDeserializer"></a>JsonSerializer JsonDeserializer</h2><p>Avoiding JS loss of accuracy<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongJsonSerializer</span> <span class="keyword">extends</span> <span class="title">JsonSerializer</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Long value, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String text = (value == <span class="keyword">null</span> ? <span class="keyword">null</span> : String.valueOf(value));</span><br><span class="line">        <span class="keyword">if</span> (text != <span class="keyword">null</span>)</span><br><span class="line">            jsonGenerator.writeString(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Deserialize input model<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongJsonDeserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">deserialize</span><span class="params">(JsonParser jsonParser, DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String value = jsonParser.getText();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value == <span class="keyword">null</span> ? <span class="keyword">null</span> : Long.parseLong(value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Deserialize long type error: &#123;&#125;"</span>, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Annotate the target property<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerialize</span>(using = LongJsonSerializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">JsonDeserialize</span>(<span class="title">using</span> </span>= LongJsonDeserializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">private</span> <span class="title">Long</span> <span class="title">id</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="Data-Binding-Commonly-used"><a href="#Data-Binding-Commonly-used" class="headerlink" title="Data Binding [Commonly used]"></a>Data Binding [Commonly used]</h2><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jackson--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Country</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String countryName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Province&gt; provinces;</span><br><span class="line">    <span class="keyword">private</span> String[] lakes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Province</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String provinceName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;City&gt; cities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">City</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String cityName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Bean2JsonStr"><a href="#Bean2JsonStr" class="headerlink" title="Bean2JsonStr"></a>Bean2JsonStr</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bean2JsonStr</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// Convert the object to Json</span></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="comment">// set format</span></span><br><span class="line">    SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">    mapper.setDateFormat(dateFormat);</span><br><span class="line">    City city1 = <span class="keyword">new</span> City(<span class="number">1</span>, <span class="string">"hangzhou"</span>);</span><br><span class="line">    City city2 = <span class="keyword">new</span> City(<span class="number">2</span>, <span class="string">"taizhou"</span>);</span><br><span class="line"></span><br><span class="line">    Province province = <span class="keyword">new</span> Province();</span><br><span class="line">    province.setId(<span class="number">1</span>);</span><br><span class="line">    List&lt;City&gt; cities = <span class="keyword">new</span> ArrayList&lt;City&gt;();</span><br><span class="line">    cities.add(city1);</span><br><span class="line">    cities.add(city2);</span><br><span class="line">    province.setCities(cities);</span><br><span class="line"></span><br><span class="line">    Country country = <span class="keyword">new</span> Country();</span><br><span class="line">    country.setCountryName(<span class="string">"China"</span>);</span><br><span class="line">    country.setId(<span class="number">1</span>);</span><br><span class="line">    country.setLakes(<span class="keyword">new</span> String[]&#123;<span class="string">"Qinghai Lake"</span>, <span class="string">"Poyang Lake"</span>, <span class="string">"Dongting Lake"</span>, <span class="string">"Taihu Lake"</span>&#125;);</span><br><span class="line">    List&lt;Province&gt; provinces = <span class="keyword">new</span> ArrayList&lt;Province&gt;();</span><br><span class="line">    provinces.add(province);</span><br><span class="line">    country.setProvinces(provinces);</span><br><span class="line">    <span class="comment">// set true make json readable, no need in produce environment</span></span><br><span class="line">    mapper.configure(SerializationFeature.INDENT_OUTPUT, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// ignore null property</span></span><br><span class="line">    mapper.setSerializationInclusion(JsonInclude.Include.NON_EMPTY);</span><br><span class="line">    <span class="comment">// java property as key in default, customize key name in @JsonProperty annotation</span></span><br><span class="line">    mapper.writeValue(<span class="keyword">new</span> File(<span class="string">"country-demo.json"</span>), country);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot; : 1,</span><br><span class="line">  &quot;countryName&quot; : &quot;China&quot;,</span><br><span class="line">  &quot;provinces&quot; : [ &#123;</span><br><span class="line">    &quot;id&quot; : 1,</span><br><span class="line">    &quot;cities&quot; : [ &#123;</span><br><span class="line">      &quot;id&quot; : 1,</span><br><span class="line">      &quot;cityName&quot; : &quot;hangzhou&quot;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      &quot;id&quot; : 2,</span><br><span class="line">      &quot;cityName&quot; : &quot;taizhou&quot;</span><br><span class="line">    &#125; ]</span><br><span class="line">  &#125; ],</span><br><span class="line">  &quot;lakes&quot; : [ &quot;Qinghai Lake&quot;, &quot;Poyang Lake&quot;, &quot;Dongting Lake&quot;, &quot;Taihu Lake&quot; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JsonStr2Bean"><a href="#JsonStr2Bean" class="headerlink" title="JsonStr2Bean"></a>JsonStr2Bean</h3><p>string -&gt; object<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">JsonStr2Bean</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    File jsonFile = <span class="keyword">new</span> File(<span class="string">"country-demo.json"</span>);</span><br><span class="line">    <span class="comment">// not interrupt unknown properties</span></span><br><span class="line">    mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">    Country country = mapper.readValue(jsonFile, Country<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    log.info(country.getCountryName());</span><br><span class="line">    List&lt;Province&gt; provinces = country.getProvinces();</span><br><span class="line">    <span class="keyword">for</span> (Province province : provinces) &#123;</span><br><span class="line">        <span class="keyword">for</span> (City city : province.getCities()) &#123;</span><br><span class="line">            log.info(city.getId() + <span class="string">" "</span> + city.getCityName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">09:52:05.570 [main] INFO jackson.JacksonDemoTester - China</span><br><span class="line">09:52:05.574 [main] INFO jackson.JacksonDemoTester - 1 hangzhou</span><br><span class="line">09:52:05.575 [main] INFO jackson.JacksonDemoTester - 2 taizhou</span><br></pre></td></tr></table></figure>
<h3 id="JsonStr2List"><a href="#JsonStr2List" class="headerlink" title="JsonStr2List"></a>JsonStr2List</h3><p>string -&gt; list<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">JsonStr2List</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    City city1 = <span class="keyword">new</span> City(<span class="number">1</span>, <span class="string">"hangzhou"</span>);</span><br><span class="line">    City city2 = <span class="keyword">new</span> City(<span class="number">2</span>, <span class="string">"taizhou"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;City&gt; cities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    cities.add(city1);</span><br><span class="line">    cities.add(city2);</span><br><span class="line"></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    String listJsonStr = mapper.writeValueAsString(cities);</span><br><span class="line">    log.info(listJsonStr);</span><br><span class="line">    List&lt;City&gt; list = mapper.readValue(listJsonStr, <span class="keyword">new</span> TypeReference&lt;List&lt;City&gt;&gt;() &#123;&#125;);</span><br><span class="line">    <span class="keyword">for</span> (City city : list) &#123;</span><br><span class="line">        log.info(<span class="string">"id:"</span> + city.getId() + <span class="string">" cityName:"</span> + city.getCityName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">09:52:15.610 [main] INFO jackson.JacksonDemoTester - China</span><br><span class="line">09:52:15.612 [main] INFO jackson.JacksonDemoTester - 1 hangzhou</span><br><span class="line">09:52:15.613 [main] INFO jackson.JacksonDemoTester - 2 taizhou</span><br></pre></td></tr></table></figure>
<h2 id="Streaming-API-high-performence"><a href="#Streaming-API-high-performence" class="headerlink" title="Streaming API [high performence]"></a>Streaming API [high performence]</h2><p>self define paser</p>
<h3 id="JsonSerializer"><a href="#JsonSerializer" class="headerlink" title="JsonSerializer"></a>JsonSerializer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CityJsonSerializer</span> <span class="keyword">extends</span> <span class="title">JsonSerializer</span>&lt;<span class="title">City</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(City city, JsonGenerator jsonGenerator, SerializerProvider arg2)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        jsonGenerator.writeStartObject();</span><br><span class="line">        <span class="keyword">if</span> ( city.getId()!=<span class="keyword">null</span>)</span><br><span class="line">            jsonGenerator.writeNumberField(<span class="string">"id"</span>, city.getId());</span><br><span class="line">        jsonGenerator.writeStringField(<span class="string">"cityName"</span>, city.getCityName());</span><br><span class="line">        jsonGenerator.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JsonDeserializer"><a href="#JsonDeserializer" class="headerlink" title="JsonDeserializer"></a>JsonDeserializer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CityJsonDeserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">List</span>&lt;<span class="title">City</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;City&gt; <span class="title">deserialize</span><span class="params">(JsonParser parser, DeserializationContext deserializationcontext)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        List&lt;City&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// deserialize array, fist token must be JsonToken.START_ARRAY '['</span></span><br><span class="line">        <span class="keyword">if</span> (!JsonToken.START_ARRAY.equals(parser.getCurrentToken())) &#123;</span><br><span class="line">            log.info(parser.getCurrentToken().asString());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// until the EOF</span></span><br><span class="line">        <span class="keyword">while</span> (!parser.isClosed()) &#123;</span><br><span class="line">            <span class="comment">// loop until the target token</span></span><br><span class="line">            JsonToken token = parser.nextToken();</span><br><span class="line">            <span class="keyword">if</span> (token == <span class="keyword">null</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// every element in array is object, so the nect JsonToken is JsonToken.START_OBJECT '&#123;'</span></span><br><span class="line">            <span class="keyword">if</span> (!JsonToken.START_OBJECT.equals(token)) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            City city = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (JsonToken.START_OBJECT.equals(token))</span><br><span class="line">                    city = <span class="keyword">new</span> City();</span><br><span class="line"></span><br><span class="line">                token = parser.nextToken();</span><br><span class="line">                <span class="keyword">if</span> (token == <span class="keyword">null</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (JsonToken.FIELD_NAME.equals(token)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"id"</span>.equals(parser.getCurrentName())) &#123;</span><br><span class="line">                        token = parser.nextToken();</span><br><span class="line">                        city.setId(parser.getIntValue());</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"cityName"</span>.equals(parser.getCurrentName())) &#123;</span><br><span class="line">                        token = parser.nextToken();</span><br><span class="line">                        city.setCityName(parser.getText());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (JsonToken.END_OBJECT.equals(token))</span><br><span class="line">                    list.add(city);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="StreamJsonStr2List"><a href="#StreamJsonStr2List" class="headerlink" title="StreamJsonStr2List"></a>StreamJsonStr2List</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StreamJsonStr2List</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    City city1 = <span class="keyword">new</span> City();</span><br><span class="line">    city1.setCityName(<span class="string">"hangzhou"</span>);</span><br><span class="line">    City city2 = <span class="keyword">new</span> City(<span class="number">2</span>, <span class="string">"taizhou"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;City&gt; cities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    cities.add(city1);</span><br><span class="line">    cities.add(city2);</span><br><span class="line"></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    SimpleModule <span class="keyword">module</span> = <span class="keyword">new</span> SimpleModule();</span><br><span class="line">    <span class="keyword">module</span>.addSerializer(City<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">CityJsonSerializer</span>())</span>;</span><br><span class="line">    mapper.registerModule(<span class="keyword">module</span>);</span><br><span class="line">    String listJsonStr = mapper.writeValueAsString(cities);</span><br><span class="line"></span><br><span class="line">    log.info(listJsonStr);</span><br><span class="line"></span><br><span class="line">    ObjectMapper mapper2 = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    SimpleModule module2 = <span class="keyword">new</span> SimpleModule();</span><br><span class="line">    module2.addDeserializer(List<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">CityJsonDeserializer</span>())</span>;</span><br><span class="line">    mapper2.registerModule(module2);</span><br><span class="line">    List&lt;City&gt; list = mapper2.readValue(listJsonStr, <span class="keyword">new</span> TypeReference&lt;List&lt;City&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (City city : list) &#123;</span><br><span class="line">        log.info(<span class="string">"id:"</span> + city.getId() + <span class="string">" cityName:"</span> + city.getCityName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10:15:03.874 [main] INFO jackson.JacksonDemoTester - [&#123;&quot;cityName&quot;:&quot;hangzhou&quot;&#125;,&#123;&quot;id&quot;:2,&quot;cityName&quot;:&quot;taizhou&quot;&#125;]</span><br><span class="line">10:15:03.889 [main] INFO jackson.JacksonDemoTester - id:null cityName:hangzhou</span><br><span class="line">10:15:03.889 [main] INFO jackson.JacksonDemoTester - id:2 cityName:taizhou</span><br></pre></td></tr></table></figure>
<p>use annotation to avoid module in code<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerialize</span>(using=CityJsonSerializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">City</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Tree-Model-flexible"><a href="#Tree-Model-flexible" class="headerlink" title="Tree Model [flexible]"></a>Tree Model [flexible]</h2><h3 id="TreeMode2Json"><a href="#TreeMode2Json" class="headerlink" title="TreeMode2Json"></a>TreeMode2Json</h3><p>no java class/ pojo, create model by tree model<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TreeMode2Json</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a factory provide node</span></span><br><span class="line">    JsonNodeFactory factory = <span class="keyword">new</span> JsonNodeFactory(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// create a factory to convert tree model to json</span></span><br><span class="line">    JsonFactory jsonFactory = <span class="keyword">new</span> JsonFactory();</span><br><span class="line">    <span class="comment">//create a json generator</span></span><br><span class="line">    JsonGenerator generator = jsonFactory.createGenerator(<span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"country-demo2.json"</span>)));</span><br><span class="line"></span><br><span class="line">    ArrayNode cities = factory.arrayNode();</span><br><span class="line">    cities.add(factory.objectNode().put(<span class="string">"id"</span>, <span class="number">1</span>).put(<span class="string">"cityName"</span>, <span class="string">"hangzhou"</span>))</span><br><span class="line">            .add(factory.objectNode().put(<span class="string">"id"</span>, <span class="number">2</span>).put(<span class="string">"cityName"</span>, <span class="string">"taizhou"</span>));</span><br><span class="line"></span><br><span class="line">    ArrayNode provinces = factory.arrayNode();</span><br><span class="line">    ObjectNode province = factory.objectNode();</span><br><span class="line">    province.put(<span class="string">"cities"</span>, cities);</span><br><span class="line">    province.put(<span class="string">"provinceName"</span>, <span class="string">"zhejiang"</span>);</span><br><span class="line">    provinces.add(province);</span><br><span class="line"></span><br><span class="line">    ObjectNode country = factory.objectNode();</span><br><span class="line">    country.put(<span class="string">"id"</span>, <span class="number">1</span>).put(<span class="string">"countryName"</span>, <span class="string">"China"</span>);</span><br><span class="line">    country.put(<span class="string">"provinces"</span>, provinces);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// caution! in default mapper not set root node</span></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    mapper.setSerializationInclusion(JsonInclude.Include.NON_EMPTY);</span><br><span class="line">    mapper.writeTree(generator, country);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="TreeModeReadJson"><a href="#TreeModeReadJson" class="headerlink" title="TreeModeReadJson"></a>TreeModeReadJson</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TreeModeReadJson</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    JsonNode node = mapper.readTree(<span class="keyword">new</span> File(<span class="string">"country-demo2.json"</span>));</span><br><span class="line">    <span class="comment">// show node type</span></span><br><span class="line">    log.info(<span class="string">"node JsonNodeType:"</span>+node.getNodeType());</span><br><span class="line">    log.info(<span class="string">"----------------sub node name----------------------"</span>);</span><br><span class="line">    Iterator&lt;String&gt; fieldNames = node.fieldNames();</span><br><span class="line">    <span class="keyword">while</span> (fieldNames.hasNext()) &#123;</span><br><span class="line">        String fieldName = fieldNames.next();</span><br><span class="line">        log.info(fieldName+<span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">"---------------------------------------------------"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">10:58:44.995 [main] INFO jackson.JacksonDemoTester - node JsonNodeType:OBJECT</span><br><span class="line">10:58:44.999 [main] INFO jackson.JacksonDemoTester - ----------------sub node name----------------------</span><br><span class="line">10:58:44.999 [main] INFO jackson.JacksonDemoTester - id</span><br><span class="line">10:58:44.999 [main] INFO jackson.JacksonDemoTester - countryName</span><br><span class="line">10:58:44.999 [main] INFO jackson.JacksonDemoTester - provinces</span><br><span class="line">10:58:45.000 [main] INFO jackson.JacksonDemoTester - ---------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/lvgg/p/7475140.html" target="_blank" rel="noopener">https://www.cnblogs.com/lvgg/p/7475140.html</a><br><a href="https://www.cnblogs.com/williamjie/p/9242451.html" target="_blank" rel="noopener">https://www.cnblogs.com/williamjie/p/9242451.html</a><br><a href="https://blog.csdn.net/gjb724332682/article/details/51586701" target="_blank" rel="noopener">https://blog.csdn.net/gjb724332682/article/details/51586701</a><br><a href="https://blog.csdn.net/java_huashan/article/details/46375857" target="_blank" rel="noopener">https://blog.csdn.net/java_huashan/article/details/46375857</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/08/28/docker-in-centeros7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/28/docker-in-centeros7/" class="post-title-link" itemprop="url">docker in centeros7</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-08-28 18:39:27" itemprop="dateCreated datePublished" datetime="2019-08-28T18:39:27+08:00">2019-08-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-15 21:38:58" itemprop="dateModified" datetime="2019-10-15T21:38:58+08:00">2019-10-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>update yum package first<br><code>yum update</code></p>
<p>remove old version<br><code>yum remove docker  docker-common docker-selinux docker-engine</code></p>
<p>install dependency and <code>yum-config-manager</code> in <code>yum-utils</code></p>
<p><code>yum install -y yum-utils device-mapper-persistent-data lvm2</code></p>
<p>set yum repository<br><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code></p>
<p>install<br><code>yum install docker-ce docker-ce-cli containerd.io</code></p>
<h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><p>Requires: container-selinux &gt;= 2.7.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">yum install epel-release</span><br><span class="line">yum install container-selinux</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/</a><br><a href="https://blog.csdn.net/cai454692590/article/details/83479000" target="_blank" rel="noopener">https://blog.csdn.net/cai454692590/article/details/83479000</a><br><a href="https://blog.csdn.net/renzhixin1314/article/details/88604096" target="_blank" rel="noopener">https://blog.csdn.net/renzhixin1314/article/details/88604096</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/08/27/proxy-in-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/27/proxy-in-linux/" class="post-title-link" itemprop="url">proxy in linux</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-08-27 23:49:27" itemprop="dateCreated datePublished" datetime="2019-08-27T23:49:27+08:00">2019-08-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-15 21:38:58" itemprop="dateModified" datetime="2019-10-15T21:38:58+08:00">2019-10-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="global-proxy"><a href="#global-proxy" class="headerlink" title="global proxy"></a>global proxy</h2><p>in file <code>/etc/profile</code> set<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export proxy=&quot;http://user:pwd1@192.168.3.1:8848&quot;</span><br><span class="line">export http_proxy=$proxy</span><br><span class="line">export https_proxy=$proxy</span><br><span class="line">export ftp_proxy=$proxy</span><br><span class="line">export no_proxy=&quot;localhost, 127.0.0.1, ::1&quot;</span><br></pre></td></tr></table></figure></p>
<p>unset command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unset http_proxy</span><br><span class="line">unset https_proxy</span><br><span class="line">unset ftp_proxy</span><br><span class="line">unset no_proxy</span><br></pre></td></tr></table></figure></p>
<p>load variables<br><code>source /etc/profile</code></p>
<h2 id="yum-proxy"><a href="#yum-proxy" class="headerlink" title="yum proxy"></a>yum proxy</h2><p>in file <code>/etc/yum.conf</code> set</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy=http://192.168.3.1:8848</span><br><span class="line">proxy_username=user</span><br><span class="line">proxy_password=pwd</span><br></pre></td></tr></table></figure>
<h2 id="npm-proxy"><a href="#npm-proxy" class="headerlink" title="npm proxy"></a>npm proxy</h2><p>set command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy http://user:pwd@192.168.3.1:8848</span><br><span class="line">npm confit set https-proxy http://user:pwd@192.168.3.1:8848</span><br></pre></td></tr></table></figure></p>
<p>unset command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure></p>
<p>npm setting<br><a href="https://segmentfault.com/a/1190000002589144" target="_blank" rel="noopener">https://segmentfault.com/a/1190000002589144</a></p>
<h2 id="maven-proxy"><a href="#maven-proxy" class="headerlink" title="maven proxy"></a>maven proxy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;proxy&gt;</span><br><span class="line">    &lt;id&gt;optional&lt;/id&gt;</span><br><span class="line">    &lt;active&gt;true&lt;/active&gt;</span><br><span class="line">    &lt;protocol&gt;http&lt;/protocol&gt;</span><br><span class="line">    &lt;username&gt;user&lt;/username&gt;</span><br><span class="line">    &lt;password&gt;pwd&lt;/password&gt;</span><br><span class="line">    &lt;host&gt;192.168.3.1&lt;/host&gt;</span><br><span class="line">    &lt;port&gt;8080&lt;/port&gt;</span><br><span class="line">    &lt;nonProxyHosts&gt;localhost|127.0.0.1&lt;/nonProxyHosts&gt;</span><br><span class="line">  &lt;/proxy&gt;</span><br><span class="line">&lt;/proxies&gt;</span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/EasonJim/p/9826681.html" target="_blank" rel="noopener">https://www.cnblogs.com/EasonJim/p/9826681.html</a><br><a href="https://blog.csdn.net/yanzi1225627/article/details/80247758" target="_blank" rel="noopener">https://blog.csdn.net/yanzi1225627/article/details/80247758</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linchenguang.com/2019/08/23/Hello-jenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BurningBright">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/23/Hello-jenkins/" class="post-title-link" itemprop="url">Hello jenkins</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-08-23 11:27:14" itemprop="dateCreated datePublished" datetime="2019-08-23T11:27:14+08:00">2019-08-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-15 21:38:58" itemprop="dateModified" datetime="2019-10-15T21:38:58+08:00">2019-10-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="install-jenkins"><a href="#install-jenkins" class="headerlink" title="install jenkins"></a>install jenkins</h2><p>Download jenkins.war, tomcat 8<br>if install suggested plugins report error like this<br>“No such plugin: cloudbees-folder”</p>
<p>install <code>cloudbees-folder.hpi</code> first</p>
<h2 id="install-plugins"><a href="#install-plugins" class="headerlink" title="install plugins"></a>install plugins</h2><p>install <code>Maven Integration</code>, if error then in plugin management<br>upload plugin package manually.</p>
<h2 id="proxy-server"><a href="#proxy-server" class="headerlink" title="proxy server"></a>proxy server</h2><p>if jenkins server can’t visit internet then use proxy, and have a try again.<br><a href="https://github.com/adamfisk/LittleProxy" target="_blank" rel="noopener">https://github.com/adamfisk/LittleProxy</a><br>username:user1<br>password:user2</p>
<h2 id="maven-setting"><a href="#maven-setting" class="headerlink" title="maven setting"></a>maven setting</h2><p>maven can set proxy too, modify <code>setting.xml</code>, add proxy setting<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;proxy&gt;</span><br><span class="line">    &lt;id&gt;optional&lt;/id&gt;</span><br><span class="line">    &lt;active&gt;true&lt;/active&gt;</span><br><span class="line">    &lt;protocol&gt;http&lt;/protocol&gt;</span><br><span class="line">    &lt;username&gt;user1&lt;/username&gt;</span><br><span class="line">    &lt;password&gt;user2&lt;/password&gt;</span><br><span class="line">    &lt;host&gt;192.168.1.2&lt;/host&gt;</span><br><span class="line">    &lt;port&gt;8080&lt;/port&gt;</span><br><span class="line">    &lt;nonProxyHosts&gt;localhost|127.0.0.1&lt;/nonProxyHosts&gt;</span><br><span class="line">  &lt;/proxy&gt;</span><br><span class="line">&lt;/proxies&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="git-setting"><a href="#git-setting" class="headerlink" title="git setting"></a>git setting</h2><p>save git account in linux server<br><code>vim .git-credentials</code><br>add <code>http(s)://{username}:{password}@serverAddress</code><br>add setting<br><code>git config --global credential.helper store</code></p>
<h2 id="prevent-preocess-be-killed"><a href="#prevent-preocess-be-killed" class="headerlink" title="prevent preocess be killed"></a>prevent preocess be killed</h2><ol>
<li>add command <code>BUILD_ID=DONTKILLME</code> in every shell input</li>
<li>add param <code>-Dhudson.util.ProcessTree.disable=true</code> in java command</li>
<li>add setting <code>JAVA_OPTS=&quot;$JAVA_OPTS -Dhudson.util.ProcessTree.disable=true&quot;</code> in <code>catalina.sh</code></li>
</ol>
<h3 id="install-jenkins-1"><a href="#install-jenkins-1" class="headerlink" title="install jenkins"></a>install jenkins</h3><p><a href="https://blog.csdn.net/utopiaofartoria/article/details/79612754" target="_blank" rel="noopener">https://blog.csdn.net/utopiaofartoria/article/details/79612754</a><br><a href="https://blog.csdn.net/ming19951224/article/details/80958761" target="_blank" rel="noopener">https://blog.csdn.net/ming19951224/article/details/80958761</a></p>
<h3 id="jenkins-experience"><a href="#jenkins-experience" class="headerlink" title="jenkins experience"></a>jenkins experience</h3><p><a href="https://www.jianshu.com/p/06d2c7fda227" target="_blank" rel="noopener">https://www.jianshu.com/p/06d2c7fda227</a></p>
<h3 id="setting-of-tools"><a href="#setting-of-tools" class="headerlink" title="setting of tools"></a>setting of tools</h3><p><a href="https://www.cnblogs.com/wkrbky/p/6351243.html" target="_blank" rel="noopener">https://www.cnblogs.com/wkrbky/p/6351243.html</a><br><a href="https://www.cnblogs.com/zhuiluoyu/p/7723949.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhuiluoyu/p/7723949.html</a></p>
<h3 id="global-proxy"><a href="#global-proxy" class="headerlink" title="global proxy"></a>global proxy</h3><p><a href="https://www.cnblogs.com/EasonJim/p/9826681.html" target="_blank" rel="noopener">https://www.cnblogs.com/EasonJim/p/9826681.html</a></p>
<h2 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h2><p><a href="http://ftp.icm.edu.pl/packages/jenkins/plugins" target="_blank" rel="noopener">http://ftp.icm.edu.pl/packages/jenkins/plugins</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Leon</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">211</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">75</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/burningbright" title="GitHub &rarr; https://github.com/burningbright" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.mathjax.org/#demo" title="https://www.mathjax.org/#demo" rel="noopener" target="_blank">mathjax</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.katex.org" title="https://www.katex.org" rel="noopener" target="_blank">katex</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/cron" title="http://www.linchenguang.com/cron" rel="noopener" target="_blank">cron</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/dos" title="http://www.linchenguang.com/dos" rel="noopener" target="_blank">dos</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/keyboard" title="http://www.linchenguang.com/keyboard" rel="noopener" target="_blank">keyboard</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/regex" title="http://www.linchenguang.com/regex" rel="noopener" target="_blank">regex</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/sql" title="http://www.linchenguang.com/sql" rel="noopener" target="_blank">sql</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.linchenguang.com/toy" title="http://www.linchenguang.com/toy" rel="noopener" target="_blank">toy</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leon</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  



  




  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
